<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Find New Business Owners Near You!</title>
  <meta name="description" content="Get daily emails with new local businesses, including their phone and email. Sign up now to grow your business!">
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
/* ===== FAQ Section ===== */
.faq-section {
  background: #ffffff;  /* solid white background */
  position: relative;
}

.faq-section .container {
  background: #ffffff;  /* ensure container is also solid white */
  position: relative;
  z-index: 1;
}

.faq-grid {
  display: grid;
  gap: clamp(20px, 3vw, 28px);
  max-width: 1380px;
  margin: 0 auto;
}

.faq-item {
  background: #ffffff;  /* solid white card */
  border: 2px solid var(--border);  /* thicker border for visibility */
  border-radius: var(--radius);
  padding: clamp(24px, 3.5vw, 32px);  /* more padding */
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);  /* stronger shadow */
}

.faq-question {
  color: var(--ink-900);  /* darker, more visible */
  font-size: clamp(22px, 2.4vw, 26px);  /* larger */
  font-weight: 800;  /* bolder */
  margin: 0 0 16px 0;
  line-height: 1.3;
}

.faq-answer {
  color: var(--ink-700);
  font-size: clamp(19px, 1.8vw, 22px);  /* larger text */
  line-height: 1.8;
}

.faq-answer p {
  margin: 0;
}

.faq-answer ul {
  margin: 8px 0 0 0;
  padding-left: 24px;
}

.faq-answer li {
  margin-bottom: 14px;
  line-height: 1.7;
}

.faq-answer strong {
  color: var(--ink-900);
  font-weight: 700;
}

/* Section heading */
.faq-section h2 {
  color: var(--ink-900);
  font-weight: 800;
}

    /* ===== Brand (softer finance blues) ===== */
    :root{
      --blue-deep:#0f3658;     /* deep, not neon */
      --blue-soft:#2a5ea9;     /* softer primary */
      --blue-tint:#e9f1fb;     /* gentle tint */
      --ink-900:#0f172a;
      --ink-700:#1f2937;
      --ink-600:#334155;
      --border:#e5e7eb;
      --bg:#f6f8fb;
      --card:#ffffff;
      --radius:18px;
      --shadow:0 10px 28px rgba(17,24,39,.08);
      --focus: 0 0 0 3px rgba(42,94,169,.25);
--hero-h: calc(100svh + 0.25in);

    }

/* --- Preview masking --- */
.only-city-visible td:not(.city):not(.formation) .mask { filter: blur(7px); opacity:.95; }
.only-city-visible td:not(.city):not(.formation) .mask::selection { background:transparent; }
.only-city-visible td:not(.city):not(.formation) { user-select: none; }
.only-city-visible td.city,
.only-city-visible td.formation { filter:none; }

/* Make long cells wrap nicely */
td, th { vertical-align: top; }


/* Results section background only */
.section-results {
  background: #163B5A;     /* the blue in your screenshot */
}
.section-results h2 {
  color: #fff;              /* keep the heading readable on blue */
}

/* Pricing footnote */
.pricing-note{
  margin-top: 14px;
  color: var(--ink-600);
  font-size: clamp(15px,1.2vw,17px);
  line-height: 1.6;
  text-align: center;
  max-width: 920px;
  margin-inline: auto;
}



    /* ===== Base ===== */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--ink-700);
      line-height:1.7;
      -webkit-font-smoothing:antialiased;
    }
    .container{max-width:1200px;margin:0 auto;padding-inline:clamp(16px,3vw,48px)}
    .section{padding-block:clamp(52px,7vw,92px)}
    .alt{background:linear-gradient(#fff, #f7f9ff)}

    h1,h2{color:var(--ink-900);margin:0 0 .5rem 0}
    h1{font-size:clamp(34px,4.2vw,56px);letter-spacing:.2px}
    h2{font-size:clamp(26px,3vw,36px)}
    p{font-size:clamp(18px,1.6vw,20px)}
    .lead{color:#20324b}

    .btn{
      display:inline-block;border:0;border-radius:14px;
      background:var(--blue-soft);color:#fff;font-weight:800;
      padding:16px 20px;font-size:clamp(18px,1.4vw,20px);
      box-shadow:var(--shadow); cursor:pointer;
    }
    .btn:focus{outline:none; box-shadow:var(--focus)}

    input,select{
      width:100%;padding:16px 14px;font-size:20px;
      border:1.5px solid var(--border);border-radius:14px;
    }
    input:focus,select:focus{outline:none; box-shadow:var(--focus)}

    /* ===== Header ===== */
    .header{background:#fff;box-shadow:var(--shadow)}
    .header-inner{display:flex;align-items:center;justify-content:space-between;padding-block:14px}
    .logo{font-weight:800;color:var(--blue-soft);font-size:clamp(20px,2.2vw,26px)}

    /* ===== HERO: background image + soft overlay + blurred feather (no line) ===== */
    .hero{
  position: relative;
  color: #fff;
  min-height: 100vh;
  padding: clamp(64px, 10vw, 120px) 0 clamp(64px, 8vw, 100px);
}
    .hero::before{
  content:"";
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 100vh;
  background: linear-gradient(
    to right,
    rgba(15,54,88,.95) 0%,
    rgba(15,54,88,.72) 40%,
    rgba(15,54,88,.30) 70%,
    rgba(15,54,88,0)   100%
  );
  pointer-events:none;
  z-index: -1;
}

    /* blurred feather into next section */
    .hero::after{
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 100vh;
  background: var(--hero-bg) center / cover no-repeat;
  z-index: -2;
}

    .hero-inner{
  position: relative;
  z-index: 1;
  display: grid;
  gap: clamp(28px,3vw,52px);
  align-items: start;  /* Changed from center */
  grid-template-columns: 1.05fr minmax(340px,540px);
}

    .hero h1{color:#f7fbff}
    .hero .lead{color:#e9f1fb}

    .form-card{
  margin-top:clamp(16px,2vw,24px);
  margin-bottom:clamp(24px,3vw,40px);
  background:#fff;
  color:var(--ink-700);
  padding:clamp(18px,2.2vw,26px);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  width:min(560px,100%);
  min-height: 200px;  /* Ensure it has substance */
  overflow:visible;
}

    .form-card .btn{width:100%; margin-top:10px}

    /* We’re using the background image for the hero. You can keep this column for balance,
       or remove it if you prefer a single-column hero on desktop. */
    .hero-illustration{min-height:320px}

    @media (max-width: 980px){
      .hero-inner{grid-template-columns:1fr}
      .hero-illustration{display:none}

    }

    /* ===== How it works (with thumbnails) ===== */
    .hiw-grid{display:grid;gap:24px;grid-template-columns:repeat(3,minmax(0,1fr))}
    .hiw-card{background:var(--card);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);overflow:hidden}
    .hiw-img{width:100%;height:160px;object-fit:cover;display:block}
    .hiw-body{padding:18px}
    .hiw-body h3{margin:0 0 .35rem 0;color:var(--ink-900);font-size:clamp(18px,2vw,20px)}
    .hiw-body p{margin:.25rem 0 0}
    @media (max-width:900px){.hiw-grid{grid-template-columns:1fr}}

    /* ===== Results (card table) ===== */
    .table-wrap{background:#fff;border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);overflow:auto;min-height:180px}
    table{width:100%;border-collapse:collapse}
    thead th{background:var(--blue-tint);color:var(--blue-deep);text-align:left;font-weight:700;padding:14px;border-bottom:1px solid var(--border)}
    tbody td{padding:14px;border-bottom:1px solid var(--border);font-size:18px}
    tbody tr:hover{background:#f8fbff}

    /* ===== Pricing (accent photos) ===== */
    /* ===== Pricing (accent photos) ===== */
.pricing-grid{
  display: flex;
  gap: 24px;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
  padding-bottom: 16px;
}
    
.pricing-card{
  flex: 0 0 calc(33.333% - 16px);
  scroll-snap-align: start;
  min-width: 320px;
  max-width: 380px;
  background:#fff;
  border:1px solid var(--border);
  border-radius:18px;
  box-shadow:var(--shadow);
  overflow:hidden;
  text-align:center;
}
    .pricing-card{background:#fff;border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);overflow:hidden;text-align:center}
    .pricing-photo{height:120px;object-fit:cover;width:100%}
    .pricing-body{padding:24px}
    .price{font-weight:800;font-size:32px;margin:.25rem 0 1rem;color:var(--ink-900)}
    .pricing-card.featured{border-color:var(--blue-soft);box-shadow:0 16px 40px rgba(42,94,169,.18)}
    @media (max-width:980px){.pricing-grid{grid-template-columns:1fr}}



/* ===== Custom multiselect ===== */
.nbp-multi { position: relative; }
.nbp-multi-toggle{
  width:100%; padding:14px 14px; border:1.5px solid var(--border);
  border-radius:14px; background:#fff; text-align:left; font-size:18px;
  cursor:pointer; box-shadow:var(--shadow);
}
.nbp-multi-toggle:focus{ outline:none; box-shadow:var(--focus); }
.nbp-multi-panel{
  position: absolute;
  left: -14px;                 /* extend beyond the card padding */
  right: -14px;
  top: calc(100% + 8px);       /* sit just below the toggle */
  z-index: 50;                 /* above the card */
  background: #fff;
  border: 1px solid var(--border);
  border-radius: 14px;
  box-shadow: var(--shadow);
  padding: 8px;
  width: auto;                 /* respect left/right values */
  max-height: 260px;           /* show ~2–3 options */
}

.nbp-multi-list{
  /* show ≈3 options, then scroll */
  max-height: calc(56px * 3 + 6px);  /* 56px ≈ one row height */
  overflow: auto;
  padding: 4px;
}

.nbp-multi-item{
  display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:10px;
  cursor:pointer; user-select:none;
}
.nbp-multi-item:hover{ background:#f7f9ff; }
.nbp-multi-item input{ width:18px; height:18px; }
.nbp-multi-sep{ margin:6px 10px; color:#94a3b8; }

.nbp-multi-chips{ display:flex; flex-wrap:wrap; gap:6px; margin-top:10px; }
.nbp-chip{
  background:var(--blue-tint); color:var(--blue-deep); border-radius:999px;
  padding:6px 10px; font-size:14px; display:inline-flex; align-items:center; gap:6px;
}
.nbp-chip .x{ cursor:pointer; font-weight:700; }




/* Wizard steps */
.step[hidden] { display: none !important; }

/* iOS Safari: prevent focus-zoom on controls */
@supports (-webkit-touch-callout: none) {
  input, select, textarea, button,
  .nbp-multi-toggle,
  .nbp-multi-item span {
    font-size: 17px !important;
  }
}
.nbp-multi-toggle,
.nbp-multi-item,
.nbp-multi-item input {
  touch-action: manipulation;
}


/* --- Trial CTA button (matches your theme) --- */
.trial-cta{ text-align:center; margin: 8px 0 18px; }

.cta-big{
  Margin-top: 12px;
  display:inline-grid; gap:6px; place-items:center;
  border:0; border-radius:16px; padding:22px 26px;
  background: var(--blue-soft);
  color:#fff; text-decoration:none; font-weight:800;
  box-shadow: var(--shadow);
  width:100%;
  line-height:1.25; cursor:pointer;
}
.cta-big:hover{ box-shadow: 0 16px 34px rgba(31,107,214,.30); }
.cta-big:focus{ outline:none; box-shadow: 0 0 0 4px rgba(37,99,235,.28); }

.cta-line-1{ font-size: clamp(26px, 2.4vw, 34px); letter-spacing:.2px; }
.cta-line-2{ font-weight:600; opacity:.95; font-size: clamp(15px, 1.4vw, 18px); }

/* Lead flyer sticker */
.section-results .container { position: relative; }   /* anchor for absolute child */
.lead-sticker{
  position: absolute;
  left: clamp(8px, 2vw, -10px);
  bottom: clamp(-18px, -3vw, -26px);   /* slight overlap below the preview box */
  width: min(260px, 28vw);
  max-width: 320px;
  transform: rotate(-2deg);
  z-index: 3;                          /* on top of the table card */
  pointer-events: none;
  user-select: none;
  filter: drop-shadow(0 8px 20px rgba(0,0,0,.25));
}
/* give the section breathing room so the overlap isn't clipped */
.section-results { padding-bottom: clamp(60px, 8vw, 100px); }

/* --- Row CTA (centered) + full-row blur on hover --- */
#preview-table tbody tr.preview-row { position: relative; }

#preview-table a.row-cta{
  position:absolute; left:50%; top:50%; transform:translate(-50%, -50%); /* centered */
  background: var(--blue-soft); color:#fff; text-decoration:none;
  font-weight:800; font-size:14px; line-height:1;
  padding:10px 14px; border-radius:999px;
  box-shadow: var(--shadow);
  opacity:0; pointer-events:none; transition:opacity .18s ease;
  z-index: 2;  /* keep above blur */
}

#preview-table tbody tr.preview-row:hover a.row-cta,
#preview-table a.row-cta:focus-visible{
  opacity:1; pointer-events:auto;
}


/* Full-row blur on hover — even City + Formation */
#preview-table tbody tr.preview-row:hover td .mask{ filter: blur(8px) !important; opacity:.95; }

/* Don't blur the CTA itself */
#preview-table tbody tr.preview-row:hover a.row-cta{ filter:none !important; }

@media (max-width: 720px){
  /* optional: always show on mobile */
  #preview-table a.row-cta{ opacity:1; pointer-events:auto; }
}

:root{
  --green-mid:#16a34a;
  --green-ink:#0b4d2b;
}

.trial-kicker{ margin:6px 0 8px; font-size:16px; }
.trial-badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  background:rgba(22,163,74,.12);
  border:1px solid rgba(22,163,74,.35);
  color:var(--green-ink);
  font-weight:800;
}

/* Results subtitle on dark background */
.results-subtitle{
  color:#e9f1fb;
  opacity:.92;
  margin:6px 0 16px;
  font-size: clamp(15px,1.3vw,18px);
  line-height:1.5;
  list-style: none;
  padding: 0;
}

.results-subtitle li {
  margin-bottom: 12px;
  padding-left: 24px;
  position: relative;
}

.results-subtitle li::before {
  content: "✓";
  position: absolute;
  left: 0;
  color: #4ade80;
  font-weight: 800;
  font-size: 18px;
}

.step-progress{
  margin-top:8px;
  text-align:center;
  color:var(--ink-600);
  font-size:14px;
  font-weight:600;
}

/* Subtle Login Button Style */
.login-btn {
  position: absolute;
  top: 20px;
  right: 20px;
  padding: 8px 12px;
  font-size: 16px;
  background-color: var(--blue-soft);
  color: white;
  border: 2px solid var(--blue-soft);
  border-radius: 20px;
  font-weight: 600;
  text-decoration: none;
  transition: all 0.3s ease;
  z-index: 10; /* Ensure it's above other content like images */
}

.login-btn:hover,
.login-btn:focus {
  background-color: var(--blue-soft);
  color: white;
  border-color: var(--blue-soft);
  box-shadow: 0 14px 18px rgba(0, 0, 0, 0.35);
}

/* Login Modal Styles */
.login-modal {
  display: none; /* Hidden by default */
  position: fixed;
  z-index: 1000; /* Make sure it's above other elements */
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5); /* Transparent background */
  overflow: auto;
}

.login-modal-content {
  background-color: #fff;
  padding: 20px;
  margin: 15% auto;
  border-radius: 10px;
  width: 500px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  position: relative;
}

.close {
  color: #aaa;
  font-size: 28px;
  font-weight: bold;
  position: absolute;
  top: 10px;
  right: 20px;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

/* Input Fields and Button Styles */
form input {
  width: 100%;
  padding: 10px;
  margin-bottom: 12px;
  border: 1px solid #ddd;
  border-radius: 5px;
}

.spinner-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(233, 241, 251, 0.95);  /* light blue (matches your --blue-tint) */
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.spinner-overlay.active {
  display: flex;
}

.spinner {
  width: 60px;
  height: 60px;
  border: 6px solid #e5e7eb;
  border-top-color: #0f3658; /* dark blue */
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

    /* Smooth transitions for plan/location swap */
#plans-content,
#plans-area {
  transition: opacity 0.3s ease, transform 0.3s ease;
}

#plans-content.fade-out,
#plans-area.fade-out {
  opacity: 0;
  transform: translateY(-20px);
  pointer-events: none;
}

#plans-content.fade-in,
#plans-area.fade-in {
  opacity: 1;
  transform: translateY(0);
}

/* Temporary access message (remove when ready) */
.access-message {
  margin-top: 12px;
  color: #dc2626;
  font-size: 16px;
  font-weight: 600;
  text-align: center;
}

.access-message a {
  color: #dc2626;
  text-decoration: underline;
  cursor: pointer;
}

.access-message a:hover {
  color: #991b1b;
}

/* Hide "All of Florida" option in HERO form only */
#nbp-multi .nbp-multi-item input[data-all="1"] {
  display: none;
}

#nbp-multi .nbp-multi-item:has(input[data-all="1"]) {
  display: none;
}

/* Hide the separator line after it */
#nbp-multi .nbp-multi-sep {
  display: none;
}

/* Scroll animation for How It Works cards - Mobile only */
@media (max-width: 900px) {
  .hiw-card {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.6s ease, transform 0.6s ease;
  }
  
  .hiw-card.animate-in {
    opacity: 1;
    transform: translateY(0);
  }
  
  /* Stagger the animations slightly */
  .hiw-card:nth-child(1) { transition-delay: 0s; }
  .hiw-card:nth-child(2) { transition-delay: 0.15s; }
  .hiw-card:nth-child(3) { transition-delay: 0.3s; }
}

/* Add space below login button on mobile */
@media (max-width: 980px) {
  .login-btn {
    margin-bottom: 40px;
  }
  
  .hero-inner {
    margin-top: 80px; /* Push title and content down */
  }
}

@media (max-width: 720px) {
  .table-wrap {
    display: none;
  }
  
  .section-results .container {
    display: grid;
    grid-template-columns: 1fr 180px;
    grid-template-rows: auto auto;
    gap: 12px 16px;
    align-items: start;
    position: relative;
    justify-content: center;
  }
  
  .section-results h2 {
    grid-column: 1;
    grid-row: 1;
    margin: 0;
  }
  
  .lead-sticker {
    grid-column: 2;
    grid-row: 1 / 3;  /* spans both rows */
    position: relative;
    width: 180px;
    transform: rotate(-2deg);
    margin: 0;
    left: auto;
    bottom: auto;
    align-self: start;
  }
  
  .results-subtitle {
    grid-column: 1 / -1;
    grid-row: 2;
    margin: 0;
    font-size: 17px;
    line-height: 1.6;
  }
  
  .results-subtitle li {
    margin-bottom: 14px;
  }
}

/* ===== MOBILE-ONLY ADJUSTMENTS ===== */
@media (max-width: 980px) {
  /* 1) Hide the "Access Free Leads" CTA button on mobile */
  .trial-cta {
    display: none;
  }
  
  /* 2) Make pricing cards scroll horizontally */
  .pricing-grid {
    display: flex;
    flex-wrap: nowrap;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    gap: 16px;
    padding-bottom: 16px;
    -webkit-overflow-scrolling: touch; /* smooth scrolling on iOS */
  }
  
  .pricing-card {
    flex: 0 0 85%; /* each card takes 85% of screen width */
    scroll-snap-align: center;
    max-width: 400px; /* prevent cards from being too wide on tablets */
  }
  
  /* Optional: Add scroll indicator hint */
  .pricing-grid::after {
    content: '';
    flex: 0 0 8px; /* small spacer at end */
  }
}
    
  </style>
<script>
  // Force-hide spinner + reset form on back button
  (function() {
    function hideSpinner() {
      const s = document.getElementById('loading-spinner');
      if (s) s.classList.remove('active');
    }
    
    // Run on DOMContentLoaded (when spinner exists)
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', hideSpinner);
    } else {
      hideSpinner(); // DOM already loaded
    }
    
    // Run on pageshow (back button - critical!)
    window.addEventListener('pageshow', function(event) {
      hideSpinner();
      
      // ✅ Clear form ONLY on back button (when page loaded from cache)
      if (event.persisted) {
        // Reset wizard to step 1
        const form = document.getElementById('nbp-wizard');
        if (form) form.reset();
        
        // Show step 1, hide others
        const step1 = document.getElementById('step-1');
        const step2 = document.getElementById('step-2');
        const step3 = document.getElementById('step-3');
        const step4 = document.getElementById('step-4');
        
        if (step1) step1.hidden = false;
        if (step2) step2.hidden = true;
        if (step3) step3.hidden = true;
        if (step4) step4.hidden = true;
        
        // Clear any chips/selections
        const chips = document.getElementById('nbp-multi-chips');
        if (chips) chips.innerHTML = '';
        
        const chipsPricing = document.getElementById('nbp-multi-chips-pricing');
        if (chipsPricing) chipsPricing.innerHTML = '';
        
        // Reset hidden fields
        const hiddenCounties = document.getElementById('nbp-hidden-counties');
        if (hiddenCounties) hiddenCounties.value = '';
        
        const hiddenPricing = document.getElementById('nbp-hidden-counties-pricing');
        if (hiddenPricing) hiddenPricing.value = '';
        
        // Reset multiselect toggles
        const toggle = document.getElementById('nbp-multi-button');
        if (toggle) toggle.textContent = 'Select areas…';
        
        const togglePricing = document.getElementById('nbp-multi-button-pricing');
        if (togglePricing) togglePricing.textContent = 'Select areas…';
      }
    });
  })();

// Animate How It Works cards on scroll - Mobile only
document.addEventListener('DOMContentLoaded', () => {
  if (window.innerWidth <= 900) {
    const observerOptions = {
      threshold: 0.15,
      rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('animate-in');
          observer.unobserve(entry.target); // Only animate once
        }
      });
    }, observerOptions);
    
    document.querySelectorAll('.hiw-card').forEach(card => {
      observer.observe(card);
    });
  }
});
  
</script>
</head>

<body>

<!-- Subtle Login Button -->
<a href="/login" class="login-btn" aria-label="Login">
  Login
</a>


<!-- Login Modal -->
<div id="loginModal" class="login-modal">
  <div class="login-modal-content">
    <span class="close" id="closeModal">&times;</span>
    <h2>Login</h2>
    <form id="loginForm">
      <label for="login-email">Email:</label>
      <input type="email" id="login-email" name="email" required>

      <label for="login-password">Password:</label>
      <input type="password" id="login-password" name="password" required>

      <button type="submit" class="btn">Login</button>
      <p id="login-error" style="color:red; margin-top:10px; display:none;"></p>
    </form>
  </div>
</div>



  <!-- Header -->


  <!-- HERO (set your background image here) -->
  <section
    class="hero"
    style="--hero-bg: url('{{ url_for('static', filename='img/hero-people.png') }}');">
    <!-- ^^^ If your file is not PNG, change .png to the real extension. -->

    <div class="container hero-inner">
      <!-- Left: copy + form -->
      <div>
        <h1>Daily Leads for Accountants</h1>
        <p class="lead">Sending you brand-new local business leads to help generate new customers and clients for your business.</p>

        <form class="form-card" id="nbp-wizard" action="" method="GET" aria-label="Signup">

  <!-- hidden payload the server reads -->
  <input type="hidden" name="counties" id="nbp-hidden-counties">
  <input type="hidden" id="nbp-hidden-counties-pricing">
  <input type="hidden" name="redirect_to" id="nbp-hidden-redirect">
  <input type="hidden" id="nbp-selected-plan" name="price_id">


  <!-- STEP 1: State only -->
<div class="step" id="step-1">

  <label style="display:block;font-weight:700;margin:4px 0 6px 2px">Start by selecting a state</label>
  <select id="nbp-state" aria-label="Choose state" required>
    <option value="">Select</option>
    <option value="florida">Florida</option>
  </select>

  <button class="btn" type="button" id="to-step-2" style="margin-top:12px">Get Started for Free</button>

</div>


  <!-- STEP 2: Area (Counties) — custom multiselect -->
  <div class="step" id="step-2" hidden>
    <label style="display:block;font-weight:700;margin:4px 0 6px 2px">Select county</label>

    <div class="nbp-multi" id="nbp-multi">
      <button
        type="button"
        class="nbp-multi-toggle"
        aria-haspopup="listbox"
        aria-expanded="false"
        aria-controls="nbp-multi-panel"
        id="nbp-multi-button"
      >
        Select areas…
      </button>

      <div id="nbp-multi-panel" class="nbp-multi-panel" hidden>
        <div class="nbp-multi-list" role="listbox" aria-multiselectable="true">
          <!-- All-of-state (mutually exclusive) -->
          <label class="nbp-multi-item">
            <input type="checkbox" value="florida" data-all="1" />
            <span>All of Florida</span>
          </label>

          <div class="nbp-multi-sep" aria-hidden="true">—</div>

          <!-- Counties -->
          {% for c in counties %}
          <label class="nbp-multi-item">
            <input type="checkbox" value="{{ c.slug }}" />
            <span>{{ c.name }}</span>
          </label>
          {% endfor %}
        </div>
      </div>

      <!-- Selected chips (visual summary) -->
      <div class="nbp-multi-chips" id="nbp-multi-chips" aria-live="polite"></div>
    </div>

    <div id="nbp-multi-hidden"></div>

    <div style="display:flex;gap:10px;margin-top:12px">
      <button class="btn" type="button" id="back-to-1" style="flex:1;background:#e5e7eb;color:#0f172a;font-weight:700">Back</button>
      <button class="btn" type="button" id="to-step-3" style="flex:2">Continue</button>

    </div>

  </div>

  <!-- STEP 3: Email (required) + Phone (optional) -->
<div class="step" id="step-3" hidden>
  <label style="display:block;font-weight:700;margin:4px 0 6px 2px">Email</label>
  <input type="email" id="nbp-email" name="email" placeholder="you@example.com" required aria-label="Email" autocomplete="email">

  <label style="display:block;font-weight:700;margin:14px 0 6px 2px">
    Phone
    <span style="font-weight:400;color:var(--ink-600)"></span>
  </label>
  <input type="tel" id="nbp-phone" name="phone" placeholder="(555) 555-5555" aria-label="Phone">

  <div style="display:flex;gap:10px;margin-top:12px">
    <button class="btn" type="button" id="back-to-2" style="flex:1;background:#e5e7eb;color:#0f172a;font-weight:700">Back</button>
    <button class="btn" type="submit" id="finish" style="flex:2">Finish</button>
  </div>
</div>

</form>

      </div>

      <!-- Right column kept for layout balance; no inline image needed since hero uses a BG -->
      <div class="hero-illustration" aria-hidden="true"></div>
    </div>
  </section>

  <!-- HOW IT WORKS (using the same safe image to avoid 404s; replace later if you add files) -->
  <section class="section alt">
    <div class="container">
      <h2>How It Works</h2>
      <p>Simple steps that keep your accounting practice or bookeeping business growing without the noise.</p>
      <div class="hiw-grid">
        <div class="hiw-card">
          <img class="hiw-img" src="{{ url_for('static', filename='img/1.png') }}" alt="Illustration" />
          <div class="hiw-body">
            <h3>Pick Your Area</h3>
            <p>Choose one county or many. We send you new businesses leads in your specified location.</p>
          </div>
        </div>
        <div class="hiw-card">
          <img class="hiw-img" src="{{ url_for('static', filename='img/2.png') }}" alt="Illustration" />
          <div class="hiw-body">
            <h3>Daily Delivery</h3>
            <p>When a new business is established in your area, details and contact info are sent to your dashboard.</p>
          </div>
        </div>
        <div class="hiw-card">
          <img class="hiw-img" src="{{ url_for('static', filename='img/3.png') }}" alt="Illustration" />
          <div class="hiw-body">
            <h3>Win Customers First</h3>
            <p>Reach new owners before the competition—zero guesswork.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

<!-- RESULTS PREVIEW -->
<section class="section section-results">
  <div class="container">
    <h2>Reach New Business Owners In Your Area First</h2>
    <ul id="results-subtitle" class="results-subtitle">
      <li>Hundreds of fresh business owners become prospects daily</li>
      <li>Get in front of prospects <strong>actively looking</strong> for accounting services</li>
      <li>Gain the advantage of <strong>consistent new leads</strong> and <strong>long-term growth</strong></li>
    </ul>
      <div class="table-wrap">
  <table class="only-city-visible" id="preview-table">
    <thead>
      <tr>
        <th>Business</th>
        <th>Owner(s)</th>
        <th class="city">Location</th>
        <th>Address Data</th>
        <th>Mailing Info</th>
        <th>Contact Data</th>
        <th>Formation Date</th>
      </tr>
    </thead>
    <tbody id="preview-body"></tbody>
  </table>
</div>

<img
      class="lead-sticker"
      src="{{ url_for('static', filename='img/lead.png') }}"
      alt=""
      aria-hidden="true"
    />
    </div>
  </section>

  <!-- PRICING -->
<section id="plans" class="section alt" style="scroll-margin-top: -10px;">

  <div class="container">
    <h2 id="plans-title">Choose a Plan</h2>

    <!-- This is where we'll inject the Area selector when a plan is chosen -->
    <div id="plans-area" hidden>

<!-- STEP 2 (PRICING): Independent area selector for pricing cards -->
<div class="step" id="step-2-pricing">
  <img src="{{ url_for('static', filename='florida.png') }}" 
       alt="Florida state outline" 
       style="width: 100%; max-width: 280px; height: auto; margin: 0 auto 20px; display: block; border-radius: 12px;">
  <label style="display:block;font-weight:700;margin:4px 0 6px 2px">Select Florida County</label>

  <div class="nbp-multi" id="nbp-multi-pricing">
    <button
      type="button"
      class="nbp-multi-toggle"
      aria-haspopup="listbox"
      aria-expanded="false"
      aria-controls="nbp-multi-panel-pricing"
      id="nbp-multi-button-pricing"
    >
      Select areas…
    </button>

    <div id="nbp-multi-panel-pricing" class="nbp-multi-panel" hidden>
      <div class="nbp-multi-list" role="listbox" aria-multiselectable="true">
        <!-- All-of-state -->
        <label class="nbp-multi-item">
          <input type="checkbox" value="florida" data-all="1" />
          <span>All of Florida</span>
        </label>

        <div class="nbp-multi-sep" aria-hidden="true">—</div>

        <!-- Counties -->
        {% for c in counties %}
        <label class="nbp-multi-item">
          <input type="checkbox" value="{{ c.slug }}" />
          <span>{{ c.name }}</span>
        </label>
        {% endfor %}
      </div>
    </div>

    <!-- Selected chips -->
    <div class="nbp-multi-chips" id="nbp-multi-chips-pricing" aria-live="polite"></div>
  </div>

  <div style="display:flex;gap:10px;margin-top:12px">
    <button class="btn" type="button" id="back-to-plans" style="flex:1;background:#e5e7eb;color:#0f172a;font-weight:700">Back</button>
    <button class="btn" type="button" id="continue-to-register" style="flex:2">Continue</button>
  </div>
</div>

<!-- STEP 4: Email and Password Registration -->
<div class="step" id="step-4" hidden>
  <label style="display:block;font-weight:700;margin:4px 0 6px 2px">Email</label>
  <input type="email" id="nbp-email-register" name="email" placeholder="you@example.com" required aria-label="Email" autocomplete="email">

  <label style="display:block;font-weight:700;margin:14px 0 6px 2px">Password</label>
<input type="password" id="nbp-password" name="password" placeholder="Enter your password" required minlength="5" aria-label="Password">

<label style="display:block;font-weight:700;margin:14px 0 6px 2px">Confirm Password</label>
<input type="password" id="nbp-password-confirm" name="password_confirm" placeholder="Re-enter your password" required minlength="5" aria-label="Confirm Password" style="margin-bottom:12px">
  
  <div style="display:flex;gap:10px;margin-top:12px">
    <button class="btn" type="button" id="back-to-area" style="flex:1;background:#e5e7eb;color:#0f172a;font-weight:700">Back</button>
    <button class="btn" type="button" id="to-step-5" style="flex:2">Register and Continue</button>
  </div>
</div>
</div>

    <!-- Original plans content we will hide/show as a block -->
  <div id="plans-content">
      <div class="pricing-grid">
        
    
        <div class="pricing-card featured">
          <img class="pricing-photo" src="{{ url_for('static', filename='img/6.png') }}" alt="Local storefront" />
          <div class="pricing-body">
            <!-- <h3>Local Star</h3>-->
            <div class="trial-kicker"><span class="trial-badge">15 Free Leads included</span></div>
            <div class="price">Starter<span style="font-weight:400"></span></div>
            <ul style="list-style:none;padding:0;margin:0 0 12px 0;font-size:18px;color:var(--ink-600)">
              <li>✔ 10-18 leads per day</li><li>✔ 1 city/county</li><li>✔ Full Customer Profiles</li><li>✔ Live Support</li>
            </ul>
            <button class="btn choose-area" type="button" data-plan="local">Choose Area</button>
          </div>
        </div>

        <div class="pricing-card featured">
          <img class="pricing-photo" src="{{ url_for('static', filename='img/7.png') }}" alt="Regional skyline" />
          <div class="pricing-body">
            <!--<h3>Regional Hero</h3>-->
            <div class="trial-kicker"><span class="trial-badge">100 Free Leads included</span></div>
            <div class="price">Advanced<span style="font-weight:400"></span></div>
            <ul style="list-style:none;padding:0;margin:0 0 12px 0;font-size:18px;color:var(--ink-600)">
              <li>✔ 50-60 leads per day</li><li>✔ Up to 5 cities/counties</li><li>✔ Full Customer Profiles</li><li>✔ Live Support</li>
            </ul>
            <button class="btn choose-area" type="button" data-plan="regional">Choose Area</button>
          </div>
        </div>

        <div class="pricing-card featured">
          <img class="pricing-photo" src="{{ url_for('static', filename='img/8.png') }}" alt="State outline" />
          <div class="pricing-body">
            <!--<h3>Statewide Boss</h3>-->
            <div class="trial-kicker"><span class="trial-badge">350 Free Leads included</span></div>
            <div class="price">Enterprise<span style="font-weight:400"></span></div>
            <ul style="list-style:none;padding:0;margin:0 0 12px 0;font-size:18px;color:var(--ink-600)">
              <li>✔ 100-112 leads per day</li><li>✔ Custom Locations</li><li>✔ Full Customer Profiles</li><li>✔ Historical Lead Access</li><li>✔ Live Support and Training</li>
            </ul>
            <button class="btn choose-area" type="button" data-plan="statewide">Choose Area</button>
          </div>
        </div>
      </div>

      <div class="trial-cta">
  <a class="cta-big"
     id="trial-scroll"
     href="#plans"
     aria-label="Try Free for 30 Days — jump to Choose a Plan">
    <span class="cta-line-1">Access Free Leads In Your Area</span>
    <span class="cta-line-2">Select your State. Specifiy your Area. Find New Clients.</span>
  </a>
</div>

      <p class="pricing-note">
        Each plan provides access to leads within your selected territory. We do not directly send leads in your area to anyone other than <strong>you</strong>.
      </p>
    </div>
  </div>
</section>

<!-- FAQ SECTION -->
<section class="section faq-section">
  <div class="container">
    <h2 style="text-align:center; margin-bottom:clamp(32px,4vw,48px)">Frequently Asked Questions</h2>
    
    <div class="faq-grid">
      
      <!-- Question 1 -->
      <div class="faq-item">
        <h3 class="faq-question">What happens after I sign up?</h3>
        <div class="faq-answer">
          <ul>
            <li>Begin receiving leads immediately upon purchase with daily quantity based on plan type.</li>
            <li>Real-time updates on new businesses prospects in your selected area, so you can be the first to connect with them.</li>
            <li>Plan-based access to free leads, allowing you to begin prospecting right away!</li>
          </ul>
        </div>
      </div>

      <!-- Question 2 -->
      <div class="faq-item">
        <h3 class="faq-question">What if I decide to cancel my plan?</h3>
        <div class="faq-answer">
          <p><strong>No problem.</strong> Users are able to cancel their plan at anytime. Canceling your plan will result in loss of lead flow at the end of the current billing cycle. Billing occurs at the beginning of each month.</p>
        </div>
      </div>

      <!-- Question 3 -->
      <div class="faq-item">
        <h3 class="faq-question">How is my information handled?</h3>
        <div class="faq-answer">
          <p>We use <strong>Stripe</strong>, an accredited PCI Service Provider and globally trusted payment processor, to handle your personal and payment details. All payments are processed by Stripe, meaning your sensitive information never touches our servers.</p>
        </div>
      </div>

      <!-- Question 4 -->
      <div class="faq-item">
        <h3 class="faq-question">Who do I contact if I have questions?</h3>
        <div class="faq-answer">
          <p>Our customer support team is available 24 hours a day via email. You will also receive contact details for your personal customer service representative upon purchase.</p>
        </div>
      </div>

      <!-- Question 5 -->
      <div class="faq-item">
        <h3 class="faq-question">Are there refunds if I am not satisfied?</h3>
        <div class="faq-answer">
          <p>Customer satisfaction is our top priority. We are so confident in our data and service that we offer a <strong>100% satisfaction guarantee</strong>. If you are not completely satisfied with your purchase or the data provided, we will make it right.</p>
        </div>
      </div>

    </div>
  </div>
</section>

  <!-- FOOTER -->
  <footer class="section" style="padding-block:36px;background:#fff;border-top:1px solid var(--border)">
  <div class="container" style="text-align:center">
    <p style="margin:.2rem 0;color:var(--ink-600)"><strong>© 2025 MyBusinessLeadFinder.com</strong></p>
    <p style="margin:.2rem 0;color:var(--ink-600)">
      MyBusinessLeadFinder.com is not a CPA firm, tax advisor, financial institution, attorney, or business consultant, and does not offer professional advice, recommendations, or endorsements of any kind. Use of our services and any decisions based on the information provided are solely at the subscriber’s own risk. All rights reserved.</p>
    <p style="margin:.2rem 0;color:var(--ink-600)">
      <a href="/privacy-policy" style="color:var(--ink-600);text-decoration:none"><strong>Privacy Policy   </strong></a> | 
      <a href="/terms-of-service" style="color:var(--ink-600);text-decoration:none"><strong>   Terms of Service   </strong></a> | 
      <a href="/contact" style="color:var(--ink-600);text-decoration:none"><strong>   Contact Us</strong></a>
    </p>
  </div>
</footer>

  <!-- Loading Spinner Overlay -->
<div class="spinner-overlay" id="loading-spinner">
  <div class="spinner"></div>
</div>

  <script>

console.log('Script loaded at:', new Date().toISOString());
console.log('preview-body exists?', !!document.getElementById('preview-body'));

// Hide spinner on page load (in case user goes back)
window.addEventListener('DOMContentLoaded', () => {
  const spinner = document.getElementById('loading-spinner');
  if (spinner) spinner.classList.remove('active');
});

// ✅ ADD THIS: Also hide on pageshow (handles back button)
window.addEventListener('pageshow', (event) => {
  const spinner = document.getElementById('loading-spinner');
  if (spinner) spinner.classList.remove('active');
});

(function(){
  // ========================================
  // 🚨 TEMPORARY FEATURE FLAG 🚨
  // Set to false to remove "Must apply" messages
  // ========================================
  const REQUIRE_ACCESS_APPLICATION = true;
  
  // --- helpers ---
  const byId = (id) => document.getElementById(id);
  const emailInput = byId('nbp-email');
  const stateSel   = byId('nbp-state');

  const step1 = byId('step-1');
  const step2 = byId('step-2');
  const step3 = byId('step-3');

  // ✅ Ensure Step 1 is always visible on page load in the hero
  if (step1 && step1.parentElement.id === 'nbp-wizard') {
    show(step1);
  }

  const to2   = byId('to-step-2');
  const to3   = byId('to-step-3');
  const b1    = byId('back-to-1');
  const b2    = byId('back-to-2');
  const finish= byId('finish');
  const skip  = byId('skip-phone');

  const form  = byId('nbp-wizard');
  const hiddenCounties = byId('nbp-hidden-counties');
  const hiddenRedirect = byId('nbp-hidden-redirect');
  const phoneInput = byId('nbp-phone');
  // --- plan -> area selection bridge (inside the PLANS section) ---
const planField = document.getElementById('nbp-selected-plan');
let launchedFromPlan = false;

// Around line 1040 in your HTML
const PLAN_TO_PRICE = {
  'local': 'prod_TAYJYgmbiosE0M',
  'regional': 'prod_TAVOxM9HTFTIZj',   // ✅ Matches backend
  'statewide': 'prod_TAVPg5bT6oXvXN'   // ✅ Matches backend
};

const plansTitle   = document.getElementById('plans-title');
const plansArea    = document.getElementById('plans-area');
const plansContent = document.getElementById('plans-content');

// remember where step-2 lives so we can put it back later
const step2OrigParent = step2.parentElement;
const step2OrigNext   = step2.nextSibling; // may be text node

document.getElementById('trial-scroll')?.addEventListener('click', (e) => {
  e.preventDefault();
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

function mountStep2Into(el){
  // Don't move step-2 anymore - pricing has its own selector
  const pricingStep2 = byId('step-2-pricing');
  if (pricingStep2) show(pricingStep2);
}

// --- plan limits ---
let maxAllowed = Infinity;            // how many counties may be checked
let hideAllOption = false;            // whether to hide "All of Florida"
let lastChanged = null;               // track last toggled checkbox (for undo)

function setPlanLimits(planId){
  if (planId === 'local') { maxAllowed = 1;  hideAllOption = true; }
  else if (planId === 'regional') { maxAllowed = 10; hideAllOption = true; }
  else { maxAllowed = Infinity; hideAllOption = false; } // statewide or wizard path

  // Show/hide the "All of Florida" row + separator IN PRICING DROPDOWN ONLY
  const pricingList = byId('nbp-multi-panel-pricing')?.querySelector('.nbp-multi-list');
  if (pricingList) {
    const allLabel = pricingList.querySelector('input[data-all="1"]')?.closest('label');
    const sep = pricingList.querySelector('.nbp-multi-sep');
    
    if (allLabel) allLabel.style.display = hideAllOption ? 'none' : '';
    if (sep) sep.style.display = hideAllOption ? 'none' : '';

    // If we just hid the "All" option and it was selected, unselect it
    const allOpt = pricingList.querySelector('input[data-all="1"]');
    if (hideAllOption && allOpt && allOpt.checked){
      allOpt.checked = false;
    }

    // If current selection exceeds max, trim it (keep earliest)
    const pricingInputs = Array.from(pricingList.querySelectorAll('input[type="checkbox"]'));
    const sel = pricingInputs.filter(i => i.checked && !i.dataset.all);
    if (sel.length > maxAllowed){
      sel.slice(maxAllowed).forEach(i => i.checked = false);
    }
  }
  
  // Re-render the pricing dropdown if the function exists
  if (typeof setupPricingMulti !== 'undefined') {
    const renderPricing = window.renderPricingAreas;
    if (renderPricing) renderPricing();
  }
}

// Small toast/inline warning (simple alert for now)
function overLimitMessage(){
  const msg =
    planField.value === 'local'
      ? 'Local plan includes 1 county. Choose a different plan for more.'
      : 'Regional plan includes up to 10 counties. Choose Statewide for all counties.';
  alert(msg);
}


function restoreStep2Home(){
  if (step2OrigNext) {
    step2OrigParent.insertBefore(step2, step2OrigNext);
  } else {
    step2OrigParent.appendChild(step2);
  }
  hide(step2); // keep the hero wizard hidden again
}

function showAreaPickerFromPlan(planId){
  // ✅ Intercept "Try Free" button - scroll to top instead
  if (planId === 'free') {
    const start = window.pageYOffset;
    const duration = 1200;
    const startTime = performance.now();
    
    function scroll(currentTime) {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const easeProgress = progress < 0.5 
        ? 2 * progress * progress 
        : 1 - Math.pow(-2 * progress + 2, 2) / 2;
      
      window.scrollTo(0, start * (1 - easeProgress));
      
      if (progress < 1) requestAnimationFrame(scroll);
    }
    
    requestAnimationFrame(scroll);
    return; // Don't proceed with area picker
  }
  
  launchedFromPlan = true;
  const priceId = PLAN_TO_PRICE[planId];
  if (!priceId) {
    console.error('Invalid plan:', planId);
    return;
  }
  planField.value = priceId;

  // ✅ TEMPORARY: Regional/Statewide require application
  if (REQUIRE_ACCESS_APPLICATION && (planId === 'regional' || planId === 'statewide')) {
    const btn = document.querySelector(`button[data-plan="${planId}"]`);
    if (!btn) return;
    
    // Remove any existing message first
    const existing = btn.parentElement.querySelector('.access-message');
    if (existing) return; // Already showing message
    
    // Create and insert message
    const msg = document.createElement('div');
    msg.className = 'access-message';
    msg.innerHTML = 'Must apply for access! Start <a href="#top">here</a>.';
    
    // Add click handler to scroll to top
    msg.querySelector('a').addEventListener('click', (e) => {
      e.preventDefault();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
    
    btn.parentElement.appendChild(msg);
    return; // Don't proceed with area picker
  }

  // Statewide: pick all immediately and go to Stripe
  if (planId === 'statewide'){
    hiddenCounties.value = 'florida';
    postToStripe();
    return;
  }

  // Animate out plans content
  plansContent.classList.add('fade-out');
  
  setTimeout(() => {
    plansContent.hidden = true;
    plansContent.classList.remove('fade-out');
    
    plansTitle.textContent = 'Select Location';
    plansArea.hidden = false;
    plansArea.classList.add('fade-in');
    
    mountStep2Into(plansArea);
    setPlanLimits(planId);
    
    // Remove fade-in class after animation
    setTimeout(() => plansArea.classList.remove('fade-in'), 300);
  }, 300);
}

document.addEventListener('DOMContentLoaded', () => {
  // First, mark "Try Free" button with special plan ID
  document.querySelectorAll('.choose-area, .scroll-only-btn').forEach(btn => {
    if (btn.textContent.trim() === 'Try for Free' || btn.textContent.trim() === 'Try Free') {
      btn.dataset.plan = 'free';
    }
  });

  // Then attach click handlers to ALL buttons
  document.querySelectorAll('.choose-area, .scroll-only-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      showAreaPickerFromPlan(btn.dataset.plan);
    });
  });
});
  
// POST to Stripe with plan + selected counties (+ email if present)
function postToStripe(){
  const f = document.createElement('form');
  f.method = 'POST';
  f.action = "{{ url_for('billing.create_checkout_session') }}";

  const price = Object.assign(document.createElement('input'), {type:'hidden', name:'price_id', value: planField.value});
  const counties = Object.assign(document.createElement('input'), {type:'hidden', name:'counties', value: hiddenCounties.value || ''});
  const email = Object.assign(document.createElement('input'), {type:'hidden', name:'email', value: (document.getElementById('nbp-email')?.value || '').trim()});
    
  f.append(price, counties, email);
  document.body.appendChild(f);
  f.submit();
}


  // --- email validation ---
  function validEmail(v){
    // conservative HTML5-ish pattern
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
  }

  // --- phone validation (US-ish, optional) ---
  function normalizePhone(v){
    const digits = (v || '').replace(/\D+/g,'');
    if (digits.length === 11 && digits.startsWith('1')) return digits.slice(1);
    return digits;
  }
  function validPhoneOptional(v){
    const d = normalizePhone(v);
    if (!d) return true;          // empty = allowed (skip)
    if (d.length !== 10) return false;
    if (/^(\d)\1{9}$/.test(d)) return false;  // reject 0000000000 / all same
    return true;
  }

  // --- step toggles ---
  function show(el){ el.hidden = false; }
  function hide(el){ el.hidden = true; }

  // --- custom multiselect logic (mutually exclusive "All of Florida") ---
  const root   = document.getElementById('nbp-multi');
  const panel  = document.getElementById('nbp-multi-panel');
  const button = document.getElementById('nbp-multi-button');
  const chips  = document.getElementById('nbp-multi-chips');
  const hidden = document.getElementById('nbp-multi-hidden');
  const list   = panel ? panel.querySelector('.nbp-multi-list') : null;

  const inputs = () => list ? Array.from(list.querySelectorAll('input[type="checkbox"]')) : [];
  const allOpt = () => list ? list.querySelector('input[data-all="1"]') : null;

  function openPanel(){ if(panel){ panel.hidden=false; button.setAttribute('aria-expanded','true'); } }
  function closePanel(){ if(panel){ panel.hidden=true; button.setAttribute('aria-expanded','false'); } }
  if (button) {
    button.addEventListener('click', () => {
      const isOpen = button.getAttribute('aria-expanded') === 'true';
      isOpen ? closePanel() : openPanel();
    });
  }
  document.addEventListener('click', (e) => { if (root && !root.contains(e.target)) closePanel(); });
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closePanel(); });

  function renderAreas(){
    if (!list) return;
    const selected = inputs().filter(i => i.checked);
    const names    = selected.map(i => i.dataset.all ? 'All of Florida' : i.closest('label').innerText.trim());

    // Button label
    if (names.length === 0) button.textContent = 'Click here to select…';
    else if (names.length === 1) button.textContent = names[0];
    else button.textContent = `${names.length} areas selected`;

    // Chips
    chips.innerHTML = '';
    selected.forEach(i => {
      const label = i.dataset.all ? 'All of Florida' : i.closest('label').innerText.trim();
      const chip = document.createElement('span');
      chip.className = 'nbp-chip';
      chip.innerHTML = `<span>${label}</span><span class="x" aria-label="Remove">×</span>`;
      chip.querySelector('.x').addEventListener('click', () => { i.checked = false; renderAreas(); });
      chips.appendChild(chip);
    });

    // Build hidden "counties" inputs string for server
    const values = selected.map(i => i.value); // 'florida' or county slug(s)
    hidden.innerHTML = '';                     // (we still build a single CSV for server)
    hiddenCounties.value = values.join(',');
  }

  if (list) {
  list.addEventListener('change', (e) => {
    const t = e.target;
    if (t.type !== 'checkbox') return;

    lastChanged = t;

    // HERO WIZARD: enforce true single-select (only one checkbox at a time)
    if (!launchedFromPlan && !planField.value) {
      inputs().forEach(i => { if (i !== t) i.checked = false; });
      closePanel();
    }

    const all = allOpt();
    const selected = inputs().filter(i => i.checked);
    const pickedAll = selected.some(i => i.dataset.all === '1');
    const pickedCounty = selected.some(i => !i.dataset.all && i.value);

    // If "All of Florida" was just checked, uncheck all counties
    if (t.dataset.all === '1' && t.checked) {
      inputs().forEach(i => { if (!i.dataset.all) i.checked = false; });
    }

    // If "All" and a county co-exist, prefer counties unless "All" was just toggled
    if (pickedAll && pickedCounty && all && t !== all) {
      all.checked = false;
    }

    // Enforce cap (counts counties, not "All")
const countySel = inputs().filter(i => i.checked && !i.dataset.all);
if (countySel.length > maxAllowed) {
  if (planField.value) {
    // Pricing-card flow: show plan-based message
    if (lastChanged) lastChanged.checked = false;
    overLimitMessage();
  } else {
    // HERO wizard: true single-select, no alert
    inputs().forEach(i => { if (!i.dataset.all && i !== lastChanged) i.checked = false; });
  }
}


    renderAreas();
  });
  if (button) renderAreas();
}

// === PRICING SECTION: Independent multi-select ===
(function setupPricingMulti(){
  const root   = byId('nbp-multi-pricing');
  const panel  = byId('nbp-multi-panel-pricing');
  const button = byId('nbp-multi-button-pricing');
  const chips  = byId('nbp-multi-chips-pricing');
  const list   = panel ? panel.querySelector('.nbp-multi-list') : null;

  if (!list) return;

  const inputs = () => Array.from(list.querySelectorAll('input[type="checkbox"]'));
  const allOpt = () => list.querySelector('input[data-all="1"]');

  function openPanel(){ panel.hidden=false; button.setAttribute('aria-expanded','true'); }
  function closePanel(){ panel.hidden=true; button.setAttribute('aria-expanded','false'); }

  button.addEventListener('click', () => {
    const isOpen = button.getAttribute('aria-expanded') === 'true';
    isOpen ? closePanel() : openPanel();
  });

  document.addEventListener('click', (e) => { if (root && !root.contains(e.target)) closePanel(); });

  function renderAreas(){
    const selected = inputs().filter(i => i.checked);
    const names = selected.map(i => i.dataset.all ? 'All of Florida' : i.closest('label').innerText.trim());

    if (names.length === 0) button.textContent = 'Click here to select…';
    else if (names.length === 1) button.textContent = names[0];
    else button.textContent = `${names.length} areas selected`;

    chips.innerHTML = '';
    selected.forEach(i => {
      const label = i.dataset.all ? 'All of Florida' : i.closest('label').innerText.trim();
      const chip = document.createElement('span');
      chip.className = 'nbp-chip';
      chip.innerHTML = `<span>${label}</span><span class="x" aria-label="Remove">×</span>`;
      chip.querySelector('.x').addEventListener('click', () => { i.checked = false; renderAreas(); });
      chips.appendChild(chip);
    });

    const values = selected.map(i => i.value);
    const hiddenPricing = byId('nbp-hidden-counties-pricing');
    if (hiddenPricing) hiddenPricing.value = values.join(',');
  }

  list.addEventListener('change', (e) => {
    const t = e.target;
    if (t.type !== 'checkbox') return;

    const all = allOpt();
    const selected = inputs().filter(i => i.checked);
    const pickedAll = selected.some(i => i.dataset.all === '1');
    const pickedCounty = selected.some(i => !i.dataset.all && i.value);

    if (t.dataset.all === '1' && t.checked) {
      inputs().forEach(i => { if (!i.dataset.all) i.checked = false; });
    }

    if (pickedAll && pickedCounty && all && t !== all) {
      all.checked = false;
    }

    // Apply plan limits
    const countySel = inputs().filter(i => i.checked && !i.dataset.all);
    if (countySel.length > maxAllowed) {
      t.checked = false;
      overLimitMessage();
    }

    renderAreas();
  });

  renderAreas();
})();


  to2.addEventListener('click', async () => {
  if (stateSel.value !== 'florida') {
    stateSel.focus();
    stateSel.setCustomValidity('Select Florida');
    stateSel.reportValidity();
    return;
  }
  stateSel.setCustomValidity('');
  
  // Set wizard-specific rules when entering step 2 from hero
  planField.value = '';
  launchedFromPlan = false;
  maxAllowed = 1;
  hideAllOption = false;
  setPlanLimits(null);
  renderAreas();
  
  hide(step1); 
  show(step2);
});



  b1.addEventListener('click', () => {
  hide(step2);
  show(step1);
});

// NEW: Back button for pricing area selector
const backToPlans = byId('back-to-plans');
if (backToPlans) {
  backToPlans.addEventListener('click', () => {
    // Animate out location selector
    byId('step-2-pricing').classList.add('fade-out');
    plansArea.classList.add('fade-out');
    
    setTimeout(() => {
      hide(byId('step-2-pricing'));
      plansArea.hidden = true;
      plansArea.classList.remove('fade-out');
      
      plansTitle.textContent = 'Choose a Plan';
      plansContent.hidden = false;
      plansContent.classList.add('fade-in');
      
      planField.value = '';
      launchedFromPlan = false;
      
      // Remove fade-in class after animation
      setTimeout(() => plansContent.classList.remove('fade-in'), 300);
    }, 300);
  });
}


  to3.addEventListener('click', () => {
  const picked = (hiddenCounties.value || '').split(',').filter(Boolean);
  if (picked.length === 0) { if (button) openPanel(); return; }
  hide(step2); 
  show(step3);
});

const continueToRegister = byId('continue-to-register');
if (continueToRegister) {
  continueToRegister.addEventListener('click', () => {
    const hiddenPricing = byId('nbp-hidden-counties-pricing');
    const picked = (hiddenPricing.value || '').split(',').filter(Boolean);
    
    if (picked.length === 0) { 
      alert('Please select at least one area');
      return; 
    }

    const count = picked.includes('florida') ? Infinity : picked.length;
    if ((planField.value.includes('local') && count > 1) ||
        (planField.value.includes('regional') && count > 10)) {
      overLimitMessage();
      return;
    }

    // ✅ Redirect to JotForm for Starter plan
    if (planField.value === 'prod_TAYJYgmbiosE0M') {
      window.location.href = 'https://form.jotform.com/252773617505158';
      return;
    }

    // ✅ Copy pricing counties to main field for submission
    hiddenCounties.value = hiddenPricing.value;

    hide(byId('step-2-pricing'));
    show(byId('step-4'));
    plansTitle.textContent = 'Create Account';
  });
}



  b2.addEventListener('click', () => { hide(step3); show(step2); });

// Handle the 'Back' button in Step 4 (go back to area selection)
const backToArea = byId('back-to-area');
if (backToArea) {
  backToArea.addEventListener('click', () => {
    hide(byId('step-4'));
    show(byId('step-2-pricing'));  // ← Show PRICING's step 2
    plansTitle.textContent = 'Select Location';
  });
}

// Handle registration form submission in Step 4
const toStep5 = byId('to-step-5');
if (toStep5) {
  toStep5.addEventListener('click', async () => {
    const email = byId('nbp-email-register').value;
    const password = byId('nbp-password').value;
    const passwordConfirm = byId('nbp-password-confirm').value;

    if (!email || !password || !passwordConfirm) {
      alert("Please fill in all fields.");
      return;
    }

    if (password.length < 5) {
      const passwordInput = byId('nbp-password');
      passwordInput.focus();
      passwordInput.setCustomValidity('Password must be at least 5 characters');
      passwordInput.reportValidity();
      return;
    }

    if (password !== passwordConfirm) {
      const confirmInput = byId('nbp-password-confirm');
      confirmInput.focus();
      confirmInput.setCustomValidity('Passwords do not match');
      confirmInput.reportValidity();
      return;
    }

    // Clear any previous validation error
    byId('nbp-password-confirm').setCustomValidity('');

    // Show loading spinner
    document.getElementById('loading-spinner').classList.add('active');

    // Send registration data to the backend
    try {
      const response = await fetch('/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email: email,
          password: password,
          plan_id: planField.value,
          counties: hiddenCounties.value
        })
      });

      const data = await response.json();

      if (data.success) {
        window.location.href = data.stripe_url;
        // Note: spinner will stay visible until redirect completes
      } else {
        // Hide spinner on error
        document.getElementById('loading-spinner').classList.remove('active');
        alert(data.error || "Something went wrong. Please try again.");
      }
    } catch (error) {
      // Hide spinner on error
      document.getElementById('loading-spinner').classList.remove('active');
      alert("Registration failed. Please try again.");
    }
  });
}

  // Compute redirect target from chosen area
  function computeRedirect(){
    const picks = (hiddenCounties.value || '').split(',').filter(Boolean);
    if (picks.includes('florida')) return '/new-business/florida/';
    if (picks.length >= 1) return `/new-business/florida/county/${picks[0]}/`;
    return '/new-business/florida/'; // fallback
  }

form.addEventListener('submit', async (e) => {
  e.preventDefault();

  const ok = validPhoneOptional(phoneInput.value);
  if (!ok) {
    phoneInput.focus();
    phoneInput.setCustomValidity('Enter a valid 10-digit phone or leave blank');
    phoneInput.reportValidity();
    return;
  }
  phoneInput.setCustomValidity('');

  // Show loading spinner
  document.getElementById('loading-spinner').classList.add('active');

  // ✅ Send notification to backend
  try {
    await fetch('/api/hero-finish', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: emailInput.value,
        phone: phoneInput.value,
        state: stateSel.value,
        counties: hiddenCounties.value
      })
    });
  } catch (err) {
    console.error('Notification failed:', err);
    // Continue anyway - don't block user
  }

  // ✅ Logout user when they click Finish
  await fetch('/logout', { method: 'GET' });
  
  const redirect = computeRedirect();
  window.location.href = redirect + '?preview=1';
  // Note: spinner will stay visible until page redirects
});


  // Skip acts like submit without phone (guard in case the button isn't present)
if (skip) {
  skip.addEventListener('click', () => {
    hiddenRedirect.value = computeRedirect();
  });
}

})();

// === Fake preview table population with masked cells ===
(async function buildPreviewRows(){
  const tbody = document.getElementById('preview-body');
  if (!tbody) return;

  // A few popular US cities for fallback
  const POPULAR_US = ["New York", "Los Angeles", "Chicago", "Houston", "Phoenix", "Philadelphia", "San Antonio", "San Diego", "Dallas", "San Jose"];

  // Mapping of US state codes to nearby/major cities for simple "closest" variants
  const STATE_CITIES = {
    "FL": ["Miami", "Fort Lauderdale", "Hollywood", "Hialeah", "Miami Gardens", "Pembroke Pines", "Boca Raton", "West Palm Beach"],
    "CA": ["Los Angeles", "Long Beach", "Glendale", "Santa Monica", "Pasadena", "Anaheim", "Irvine"],
    "NY": ["New York", "Jersey City", "Newark", "Yonkers", "Hoboken", "Stamford"],
    "TX": ["Houston", "Pasadena", "Sugar Land", "Katy", "The Woodlands", "Pearland", "Baytown"],
    "IL": ["Chicago", "Evanston", "Skokie", "Cicero", "Oak Park", "Berwyn"],
    "PA": ["Philadelphia", "Upper Darby", "Camden", "Cherry Hill", "Bensalem"],
    "AZ": ["Phoenix", "Scottsdale", "Tempe", "Mesa", "Chandler", "Glendale"],
    "GA": ["Atlanta", "Sandy Springs", "Roswell", "Marietta", "Decatur"],
    "NC": ["Charlotte", "Concord", "Gastonia", "Huntersville"],
    "WA": ["Seattle", "Bellevue", "Kirkland", "Redmond"],
    // add more as you like
  };

  // Try to infer 3 nearby cities from IP; gracefully fall back
  async function getCityCandidates(){
  try {
    const ipres = await fetch("https://ipapi.co/json/", { cache: "no-store" });
    if (!ipres.ok) throw 0;
    const ip = await ipres.json();
    const zip = (ip.postal || ip.postcode || "").toString().slice(0,5);
    const country = (ip.country || ip.country_code || "").toUpperCase();
    if (!zip || country !== "US") throw 0;

    const res = await fetch(`/api/nearby-cities?zip=${zip}`);
    if (!res.ok) throw 0;
    const data = await res.json();
    if (Array.isArray(data.cities) && data.cities.length) return data.cities.slice(0,3);
    throw 0;
  } catch {
    // Florida-ish fallback
    return ["Miami","Fort Lauderdale","West Palm Beach"];
  }
}

  const cityChoices = await getCityCandidates();

  // helper to create a blurred span
  const blur = (txt) => `<span class="mask">${txt}</span>`;

  // quick faker-ish generators (deterministic enough for a preview)
  const bizNouns = ["Holdings", "Ventures", "Solutions", "Logistics", "Foods", "Outfitters", "Studios", "Systems", "Capital", "Services"];
  const owners   = ["HERNANDEZ, NOSIEL", "JOHNSON, AMY L", "PATEL, RAKESH", "MARTINEZ, LUIS", "SMITH, JOEL", "NGUYEN, LINH", "LEE, JASMINE", "KIM, DAVID"];
  const streets  = ["NW 82ND AVE", "E MAIN ST", "OAK RIDGE RD", "BISCAYNE BLVD", "BRAD CIR", "6TH AVE", "SUNSET DR", "PINE ST"];
  const types    = ["Florida Limited Liability Company", "Florida Profit Corporation", "Florida Nonprofit Corporation"];
  const phones   = ["(305) 555-1284", "(954) 555-2019", "(407) 555-4432", "(561) 555-7703", "(786) 555-9910"];
  const emails   = ["info@example.com", "support@example.com", "hello@example.com", "contact@example.com"];
  const zips     = ["33166", "33314", "33880", "33027", "33993", "33401"];

  function rand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
  function dateRecent(){
    const now = new Date();
    const past = new Date(now.getTime() - Math.floor(Math.random()*60+1)*86400000);
    return past.toLocaleDateString(undefined, {year:'numeric', month:'2-digit', day:'2-digit'});
  }

function today(){
  return new Date().toLocaleDateString(undefined, { year:'numeric', month:'long', day:'2-digit' });
}


  // Build N preview rows
  const ROWS = 5;
  const rows = [];
  for (let i=0;i<ROWS;i++){
    const city = rand(cityChoices);
    const row = `
      <tr class="preview-row">
        <td>${blur(`F${100+i} ${rand(bizNouns)} LLC`)}</td>
        <td>${blur(rand(owners))}</td>
        <td class="city"><span class="mask">${city}</span></td>
        <td>${blur(`${Math.floor(Math.random()*2999+1000)} ${rand(streets)}, FL ${rand(zips)}`)}</td>
        
        <td>${blur(`2213 Cheg Drive ${Math.floor(Math.random()*9000+1000)}, FL ${rand(zips)}`)}</td>
        <td>${blur(`${rand(phones)} · ${rand(emails)}`)}</td>
        <td class="formation">
          <span class="mask">${today()}</span>
  <a class="row-cta" href="#plans" aria-label="Show details and choose a plan">Show details</a>
</td>
      </tr>`;
    rows.push(row);
  }
  tbody.innerHTML = rows.join('');
})();

// Smooth-scroll to plans when "Show details" is clicked
document.addEventListener('click', (e) => {
  const a = e.target.closest('a.row-cta');
  if (!a) return;
  e.preventDefault();
  const el = document.getElementById('plans');
  if (!el) return;
  const y = el.getBoundingClientRect().top + window.pageYOffset + 48;
  window.scrollTo({ top: y, behavior: 'smooth' });
  setTimeout(() => window.scrollTo({ top: y, behavior: 'auto' }), 700);
});

// Get modal and button elements
const modal = document.getElementById("loginModal");
const loginButton = document.querySelector(".login-btn");
const closeModal = document.getElementById("closeModal");
const loginForm = document.getElementById("loginForm");
const loginError = document.getElementById("login-error");

// Open the modal when the login button is clicked
loginButton.onclick = function(e) {
  e.preventDefault();
  modal.style.display = "block";
}

// Close the modal when the close button is clicked
closeModal.onclick = function() {
  modal.style.display = "none";
  loginError.style.display = "none";
}

// Close the modal when clicking outside the modal content
window.onclick = function(event) {
  if (event.target === modal) {
    modal.style.display = "none";
    loginError.style.display = "none";
  }
}

// Handle login form submission
loginForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const email = document.getElementById('login-email').value;
  const password = document.getElementById('login-password').value;
  
  loginError.style.display = "none";
  
  try {
    const response = await fetch('/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    
    const data = await response.json();
    
    if (data.success) {
      // Redirect to their appropriate page
      window.location.href = data.redirect_url;
    } else {
      loginError.textContent = data.error || "Invalid email or password";
      loginError.style.display = "block";
    }
  } catch (error) {
    loginError.textContent = "Login failed. Please try again.";
    loginError.style.display = "block";
  }
});
// Dynamic page title based on form step
function updatePageTitle() {
  const step4 = byId('step-4');
  
  if (step4 && !step4.hidden) {
    document.title = 'Create Account — NewBizPulse';
  } else {
    document.title = 'NewBizPulse — Find New Businesses Near You!';
  }
}

// Watch for step changes
const observer = new MutationObserver(updatePageTitle);
const step4Element = byId('step-4');

if (step4Element) {
  observer.observe(step4Element, { 
    attributes: true, 
    attributeFilter: ['hidden'] 
  });
}

</script>
</body>
</html>
